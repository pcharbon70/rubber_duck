# Feature: Action Architecture Standardization (16.5.1)

## Summary
Create standardized base action modules and patterns to establish consistent action architecture across all RubberDuck agents, providing reusable building blocks for common action patterns.

## Requirements
- [ ] Define 5 core Action Categories (Request, Processing, Coordination, Monitoring, Utility)
- [ ] Create 5 Base Action Modules with common patterns and error handling
- [ ] Implement standardized parameter schemas and validation patterns
- [ ] Provide comprehensive documentation and usage examples
- [ ] Ensure compatibility with existing Jido.Action framework
- [ ] Create unit tests for all base action modules
- [ ] Validate no breaking changes to existing action implementations

## Research Summary

### Existing Usage Rules Checked
- **Jido Framework**: Actions must be pure functions with schema validation, return tagged tuples, use pattern matching
- **Elixir Core**: Use pattern matching over conditionals, proper error handling with tagged tuples, avoid nested case statements
- **OTP**: Proper error propagation, use GenServer patterns for stateful operations

### Documentation Reviewed
- **Jido Usage Rules**: Comprehensive patterns for Action implementation with schemas, validation, and error handling
- **Existing Base Actions**: `UpdateStateAction`, `EmitSignalAction`, `InitializeAgentAction`, `ComposeAction` provide foundation patterns

### Existing Patterns Found
- **Base Actions**: `lib/rubber_duck/jido/actions/base/*.ex` - Common utility actions (4 modules)
- **Request Pattern**: `lib/rubber_duck/jido/actions/provider/provider_request_action.ex:37` - LLM request handling with validation
- **Processing Pattern**: `lib/rubber_duck/jido/actions/generation/code_generation_action.ex:84` - Complex business logic with pipeline steps
- **Coordination Pattern**: `lib/rubber_duck/jido/actions/base/compose_action.ex` - Action composition and chaining
- **Monitoring Pattern**: `lib/rubber_duck/jido/actions/metrics/*.ex` - Metrics collection and export (7+ modules)
- **Utility Pattern**: `lib/rubber_duck/jido/actions/base/update_state_action.ex:39` - State management utilities

### Technical Approach
1. **Create Base Action Categories**: Define 5 core categories based on observed patterns in existing 100+ actions
2. **Implement Base Modules**: Create abstract base modules for each category with common patterns:
   - Parameter validation schemas
   - Error handling patterns  
   - Logging and telemetry hooks
   - Result formatting standards
3. **Provide Template Methods**: Include overridable methods for customization while maintaining consistency
4. **Add Composition Helpers**: Utilities for chaining and combining actions within categories
5. **Integration**: Seamlessly work with existing `Jido.Action` framework and `BaseAgent` patterns

## Risks & Mitigations
| Risk | Impact | Mitigation |
|------|--------|------------|
| Breaking existing actions | High | Create base modules that extend rather than replace existing patterns |
| Over-abstraction complexity | Medium | Keep base modules simple, focus on common patterns only |
| Performance overhead | Low | Use lightweight abstractions, benchmark against current implementations |
| Adoption resistance | Medium | Provide clear migration guides and demonstrate value through examples |

## Implementation Checklist
- [x] Create `lib/rubber_duck/jido/actions/base/request_action.ex` - Base for external request handling
- [x] Create `lib/rubber_duck/jido/actions/base/processing_action.ex` - Base for business logic processing  
- [x] Create `lib/rubber_duck/jido/actions/base/coordination_action.ex` - Base for multi-agent coordination
- [x] Create `lib/rubber_duck/jido/actions/base/monitoring_action.ex` - Base for metrics and health checks
- [x] Create `lib/rubber_duck/jido/actions/base/utility_action.ex` - Base for common utilities
- [x] Update `lib/rubber_duck/jido/actions/base.ex` to include new base modules
- [x] Create comprehensive test suite for all base action modules
- [ ] Add documentation with usage examples and migration guides
- [x] Verify no regressions by running existing test suite

## Final Implementation

The Action Architecture Standardization has been successfully implemented with 5 standardized base action modules:

### Created Base Action Modules

1. **BaseRequestAction** (`lib/rubber_duck/jido/actions/base/request_action.ex`)
   - External request handling with retry logic, timeouts, and error recovery
   - Common parameters: timeout, retry_attempts, retry_delay, validate_response
   - Hooks: before_request/2, handle_request/2, after_request/3, handle_error/3
   
2. **BaseProcessingAction** (`lib/rubber_duck/jido/actions/base/processing_action.ex`)
   - Business logic processing with progress tracking and telemetry
   - Common parameters: enable_progress_tracking, max_processing_time, enable_telemetry
   - Hooks: before_processing/2, process_data/2, after_processing/3, track_progress/3
   
3. **BaseCoordinationAction** (`lib/rubber_duck/jido/actions/base/coordination_action.ex`)
   - Multi-agent coordination with rollback and failure strategies
   - Common parameters: coordination_timeout, max_concurrent_operations, failure_strategy, enable_rollback
   - Hooks: before_coordination/2, coordinate_execution/2, on_step_completed/3, rollback_coordination/2
   
4. **BaseMonitoringAction** (`lib/rubber_duck/jido/actions/base/monitoring_action.ex`)
   - Metrics collection, health checks, and alerting with sampling
   - Common parameters: monitoring_interval, alert_thresholds, enable_alerting, sampling_rate
   - Hooks: before_monitoring/2, collect_metrics/2, format_metrics/3, should_alert/3
   
5. **BaseUtilityAction** (`lib/rubber_duck/jido/actions/base/utility_action.ex`)
   - Common utility operations with caching and validation
   - Common parameters: cache_result, cache_ttl, validate_input, validate_output, idempotent
   - Hooks: before_utility/2, execute_utility/2, validate_input/2, validate_output/3

### Key Features Implemented

- **Standardized Parameter Schemas**: All base modules include common parameters with defaults
- **Consistent Error Handling**: Tagged tuple returns with comprehensive error information
- **Telemetry Integration**: Built-in telemetry events for monitoring and observability
- **Hook System**: Extensible callback system for customization while maintaining consistency  
- **Response Formatting**: Standardized success/error response structures with metadata
- **Timeout Handling**: Configurable timeouts with graceful degradation
- **Logging**: Structured logging with action identification and timing

### Integration

All base modules seamlessly integrate with the existing Jido.Action framework and are available through `RubberDuck.Jido.Actions.Base.all_actions/0`. The standardized patterns provide consistency across all RubberDuck agents while maintaining flexibility for specific use cases.

## Questions for Pascal
1. Should the base action modules provide default implementations that can be overridden, or just common schemas and helpers?
2. Do you want the base modules to include built-in telemetry/logging, or keep them minimal?
3. Should we create migration utilities to help convert existing actions to use the new base modules?